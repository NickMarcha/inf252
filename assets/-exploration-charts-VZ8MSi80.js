import{x as an,y as Hn,z as Vn,A as Lt,B as Ot,D as Yt,E as Xn,h as L,j as T}from"./index-Bqmpsv54.js";function vt(t,n){return t==null||n==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function Ht(t,n){return t==null||n==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function Sn(t){let n,r,e;t.length!==2?(n=vt,r=(s,o)=>vt(t(s),o),e=(s,o)=>t(s)-o):(n=t===vt||t===Ht?t:qn,r=t,e=t);function i(s,o,a=0,f=s.length){if(a<f){if(n(o,o)!==0)return f;do{const h=a+f>>>1;r(s[h],o)<0?a=h+1:f=h}while(a<f)}return a}function l(s,o,a=0,f=s.length){if(a<f){if(n(o,o)!==0)return f;do{const h=a+f>>>1;r(s[h],o)<=0?a=h+1:f=h}while(a<f)}return a}function u(s,o,a=0,f=s.length){const h=i(s,o,a,f-1);return h>a&&e(s[h-1],o)>-e(s[h],o)?h-1:h}return{left:i,center:u,right:l}}function qn(){return 0}function Un(t){return t===null?NaN:+t}const Zn=Sn(vt),Wn=Zn.right,Qn=Sn(Un).center;function J(t,n){let r,e;if(n===void 0)for(const i of t)i!=null&&(r===void 0?i>=i&&(r=e=i):(r>i&&(r=i),e<i&&(e=i)));else{let i=-1;for(let l of t)(l=n(l,++i,t))!=null&&(r===void 0?l>=l&&(r=e=l):(r>l&&(r=l),e<l&&(e=l)))}return[r,e]}class on extends Map{constructor(n,r=te){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),n!=null)for(const[e,i]of n)this.set(e,i)}get(n){return super.get(sn(this,n))}has(n){return super.has(sn(this,n))}set(n,r){return super.set(Jn(this,n),r)}delete(n){return super.delete(Kn(this,n))}}function sn({_intern:t,_key:n},r){const e=n(r);return t.has(e)?t.get(e):r}function Jn({_intern:t,_key:n},r){const e=n(r);return t.has(e)?t.get(e):(t.set(e,r),r)}function Kn({_intern:t,_key:n},r){const e=n(r);return t.has(e)&&(r=t.get(e),t.delete(e)),r}function te(t){return t!==null&&typeof t=="object"?t.valueOf():t}const ne=Math.sqrt(50),ee=Math.sqrt(10),re=Math.sqrt(2);function wt(t,n,r){const e=(n-t)/Math.max(0,r),i=Math.floor(Math.log10(e)),l=e/Math.pow(10,i),u=l>=ne?10:l>=ee?5:l>=re?2:1;let s,o,a;return i<0?(a=Math.pow(10,-i)/u,s=Math.round(t*a),o=Math.round(n*a),s/a<t&&++s,o/a>n&&--o,a=-a):(a=Math.pow(10,i)*u,s=Math.round(t/a),o=Math.round(n/a),s*a<t&&++s,o*a>n&&--o),o<s&&.5<=r&&r<2?wt(t,n,r*2):[s,o,a]}function ae(t,n,r){if(n=+n,t=+t,r=+r,!(r>0))return[];if(t===n)return[t];const e=n<t,[i,l,u]=e?wt(n,t,r):wt(t,n,r);if(!(l>=i))return[];const s=l-i+1,o=new Array(s);if(e)if(u<0)for(let a=0;a<s;++a)o[a]=(l-a)/-u;else for(let a=0;a<s;++a)o[a]=(l-a)*u;else if(u<0)for(let a=0;a<s;++a)o[a]=(i+a)/-u;else for(let a=0;a<s;++a)o[a]=(i+a)*u;return o}function Vt(t,n,r){return n=+n,t=+t,r=+r,wt(t,n,r)[2]}function ie(t,n,r){n=+n,t=+t,r=+r;const e=n<t,i=e?Vt(n,t,r):Vt(t,n,r);return(e?-1:1)*(i<0?1/-i:i)}function oe(t,n){let r;if(n===void 0)for(const e of t)e!=null&&(r<e||r===void 0&&e>=e)&&(r=e);else{let e=-1;for(let i of t)(i=n(i,++e,t))!=null&&(r<i||r===void 0&&i>=i)&&(r=i)}return r}function se(t,n){let r;if(n===void 0)for(const e of t)e!=null&&(r>e||r===void 0&&e>=e)&&(r=e);else{let e=-1;for(let i of t)(i=n(i,++e,t))!=null&&(r>i||r===void 0&&i>=i)&&(r=i)}return r}function le(t,n,r){t=+t,n=+n,r=(i=arguments.length)<2?(n=t,t=0,1):i<3?1:+r;for(var e=-1,i=Math.max(0,Math.ceil((n-t)/r))|0,l=new Array(i);++e<i;)l[e]=t+e*r;return l}function ce(t){return t}var bt=1,Tt=2,Xt=3,ht=4,ln=1e-6;function ue(t){return"translate("+t+",0)"}function fe(t){return"translate(0,"+t+")"}function he(t){return n=>+t(n)}function de(t,n){return n=Math.max(0,t.bandwidth()-n*2)/2,t.round()&&(n=Math.round(n)),r=>+t(r)+n}function ge(){return!this.__axis}function Wt(t,n){var r=[],e=null,i=null,l=6,u=6,s=3,o=typeof window<"u"&&window.devicePixelRatio>1?0:.5,a=t===bt||t===ht?-1:1,f=t===ht||t===Tt?"x":"y",h=t===bt||t===Xt?ue:fe;function c(d){var p=e??(n.ticks?n.ticks.apply(n,r):n.domain()),y=i??(n.tickFormat?n.tickFormat.apply(n,r):ce),x=Math.max(l,0)+s,M=n.range(),v=+M[0]+o,g=+M[M.length-1]+o,m=(n.bandwidth?de:he)(n.copy(),o),b=d.selection?d.selection():d,w=b.selectAll(".domain").data([null]),$=b.selectAll(".tick").data(p,n).order(),R=$.exit(),A=$.enter().append("g").attr("class","tick"),E=$.select("line"),j=$.select("text");w=w.merge(w.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),$=$.merge(A),E=E.merge(A.append("line").attr("stroke","currentColor").attr(f+"2",a*l)),j=j.merge(A.append("text").attr("fill","currentColor").attr(f,a*x).attr("dy",t===bt?"0em":t===Xt?"0.71em":"0.32em")),d!==b&&(w=w.transition(d),$=$.transition(d),E=E.transition(d),j=j.transition(d),R=R.transition(d).attr("opacity",ln).attr("transform",function(N){return isFinite(N=m(N))?h(N+o):this.getAttribute("transform")}),A.attr("opacity",ln).attr("transform",function(N){var k=this.parentNode.__axis;return h((k&&isFinite(k=k(N))?k:m(N))+o)})),R.remove(),w.attr("d",t===ht||t===Tt?u?"M"+a*u+","+v+"H"+o+"V"+g+"H"+a*u:"M"+o+","+v+"V"+g:u?"M"+v+","+a*u+"V"+o+"H"+g+"V"+a*u:"M"+v+","+o+"H"+g),$.attr("opacity",1).attr("transform",function(N){return h(m(N)+o)}),E.attr(f+"2",a*l),j.attr(f,a*x).text(y),b.filter(ge).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===Tt?"start":t===ht?"end":"middle"),b.each(function(){this.__axis=m})}return c.scale=function(d){return arguments.length?(n=d,c):n},c.ticks=function(){return r=Array.from(arguments),c},c.tickArguments=function(d){return arguments.length?(r=d==null?[]:Array.from(d),c):r.slice()},c.tickValues=function(d){return arguments.length?(e=d==null?null:Array.from(d),c):e&&e.slice()},c.tickFormat=function(d){return arguments.length?(i=d,c):i},c.tickSize=function(d){return arguments.length?(l=u=+d,c):l},c.tickSizeInner=function(d){return arguments.length?(l=+d,c):l},c.tickSizeOuter=function(d){return arguments.length?(u=+d,c):u},c.tickPadding=function(d){return arguments.length?(s=+d,c):s},c.offset=function(d){return arguments.length?(o=+d,c):o},c}function me(t){return Wt(bt,t)}function St(t){return Wt(Xt,t)}function mt(t){return Wt(ht,t)}function O(t){return typeof t=="string"?new an([[document.querySelector(t)]],[document.documentElement]):new an([[t]],Hn)}function pe(t){let n;for(;n=t.sourceEvent;)t=n;return t}function kt(t,n){if(t=pe(t),n===void 0&&(n=t.currentTarget),n){var r=n.ownerSVGElement||n;if(r.createSVGPoint){var e=r.createSVGPoint();return e.x=t.clientX,e.y=t.clientY,e=e.matrixTransform(n.getScreenCTM().inverse()),[e.x,e.y]}if(n.getBoundingClientRect){var i=n.getBoundingClientRect();return[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop]}}return[t.pageX,t.pageY]}function xe(t,n){n||(n=[]);var r=t?Math.min(n.length,t.length):0,e=n.slice(),i;return function(l){for(i=0;i<r;++i)e[i]=t[i]*(1-l)+n[i]*l;return e}}function ye(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Me(t,n){var r=n?n.length:0,e=t?Math.min(r,t.length):0,i=new Array(e),l=new Array(r),u;for(u=0;u<e;++u)i[u]=Qt(t[u],n[u]);for(;u<r;++u)l[u]=n[u];return function(s){for(u=0;u<e;++u)l[u]=i[u](s);return l}}function ve(t,n){var r=new Date;return t=+t,n=+n,function(e){return r.setTime(t*(1-e)+n*e),r}}function be(t,n){var r={},e={},i;(t===null||typeof t!="object")&&(t={}),(n===null||typeof n!="object")&&(n={});for(i in n)i in t?r[i]=Qt(t[i],n[i]):e[i]=n[i];return function(l){for(i in r)e[i]=r[i](l);return e}}function Qt(t,n){var r=typeof n,e;return n==null||r==="boolean"?Vn(n):(r==="number"?Lt:r==="string"?(e=Ot(n))?(n=e,Yt):Xn:n instanceof Ot?Yt:n instanceof Date?ve:ye(n)?xe:Array.isArray(n)?Me:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?be:Lt)(t,n)}function we(t,n){return t=+t,n=+n,function(r){return Math.round(t*(1-r)+n*r)}}var cn=Math.abs,Gt=Math.cos,Bt=Math.sin,En=Math.PI,xt=En/2,un=En*2,fn=Math.max,Dt=1e-12;function hn(t,n){return Array.from({length:n-t},(r,e)=>t+e)}function ke(t){return function(n,r){return t(n.source.value+n.target.value,r.source.value+r.target.value)}}function Ae(){return Ne(!1)}function Ne(t,n){var r=0,e=null,i=null,l=null;function u(s){var o=s.length,a=new Array(o),f=hn(0,o),h=new Array(o*o),c=new Array(o),d=0,p;s=Float64Array.from({length:o*o},(y,x)=>s[x/o|0][x%o]);for(let y=0;y<o;++y){let x=0;for(let M=0;M<o;++M)x+=s[y*o+M]+t*s[M*o+y];d+=a[y]=x}d=fn(0,un-r*o)/d,p=d?r:un/o;{let y=0;e&&f.sort((x,M)=>e(a[x],a[M]));for(const x of f){const M=y;{const v=hn(0,o).filter(g=>s[x*o+g]||s[g*o+x]);i&&v.sort((g,m)=>i(s[x*o+g],s[x*o+m]));for(const g of v){let m;if(x<g?(m=h[x*o+g]||(h[x*o+g]={source:null,target:null}),m.source={index:x,startAngle:y,endAngle:y+=s[x*o+g]*d,value:s[x*o+g]}):(m=h[g*o+x]||(h[g*o+x]={source:null,target:null}),m.target={index:x,startAngle:y,endAngle:y+=s[x*o+g]*d,value:s[x*o+g]},x===g&&(m.source=m.target)),m.source&&m.target&&m.source.value<m.target.value){const b=m.source;m.source=m.target,m.target=b}}c[x]={index:x,startAngle:M,endAngle:y,value:a[x]}}y+=p}}return h=Object.values(h),h.groups=c,l?h.sort(l):h}return u.padAngle=function(s){return arguments.length?(r=fn(0,s),u):r},u.sortGroups=function(s){return arguments.length?(e=s,u):e},u.sortSubgroups=function(s){return arguments.length?(i=s,u):i},u.sortChords=function(s){return arguments.length?(s==null?l=null:(l=ke(s))._=s,u):l&&l._},u}const qt=Math.PI,Ut=2*qt,rt=1e-6,$e=Ut-rt;function jn(t){this._+=t[0];for(let n=1,r=t.length;n<r;++n)this._+=arguments[n]+t[n]}function _e(t){let n=Math.floor(t);if(!(n>=0))throw new Error(`invalid digits: ${t}`);if(n>15)return jn;const r=10**n;return function(e){this._+=e[0];for(let i=1,l=e.length;i<l;++i)this._+=Math.round(arguments[i]*r)/r+e[i]}}class Jt{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?jn:_e(n)}moveTo(n,r){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,r){this._append`L${this._x1=+n},${this._y1=+r}`}quadraticCurveTo(n,r,e,i){this._append`Q${+n},${+r},${this._x1=+e},${this._y1=+i}`}bezierCurveTo(n,r,e,i,l,u){this._append`C${+n},${+r},${+e},${+i},${this._x1=+l},${this._y1=+u}`}arcTo(n,r,e,i,l){if(n=+n,r=+r,e=+e,i=+i,l=+l,l<0)throw new Error(`negative radius: ${l}`);let u=this._x1,s=this._y1,o=e-n,a=i-r,f=u-n,h=s-r,c=f*f+h*h;if(this._x1===null)this._append`M${this._x1=n},${this._y1=r}`;else if(c>rt)if(!(Math.abs(h*o-a*f)>rt)||!l)this._append`L${this._x1=n},${this._y1=r}`;else{let d=e-u,p=i-s,y=o*o+a*a,x=d*d+p*p,M=Math.sqrt(y),v=Math.sqrt(c),g=l*Math.tan((qt-Math.acos((y+c-x)/(2*M*v)))/2),m=g/v,b=g/M;Math.abs(m-1)>rt&&this._append`L${n+m*f},${r+m*h}`,this._append`A${l},${l},0,0,${+(h*d>f*p)},${this._x1=n+b*o},${this._y1=r+b*a}`}}arc(n,r,e,i,l,u){if(n=+n,r=+r,e=+e,u=!!u,e<0)throw new Error(`negative radius: ${e}`);let s=e*Math.cos(i),o=e*Math.sin(i),a=n+s,f=r+o,h=1^u,c=u?i-l:l-i;this._x1===null?this._append`M${a},${f}`:(Math.abs(this._x1-a)>rt||Math.abs(this._y1-f)>rt)&&this._append`L${a},${f}`,e&&(c<0&&(c=c%Ut+Ut),c>$e?this._append`A${e},${e},0,1,${h},${n-s},${r-o}A${e},${e},0,1,${h},${this._x1=a},${this._y1=f}`:c>rt&&this._append`A${e},${e},0,${+(c>=qt)},${h},${this._x1=n+e*Math.cos(l)},${this._y1=r+e*Math.sin(l)}`)}rect(n,r,e,i){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+r}h${e=+e}v${+i}h${-e}Z`}toString(){return this._}}function In(){return new Jt}In.prototype=Jt.prototype;var Re=Array.prototype.slice;function at(t){return function(){return t}}function Se(t){return t.source}function Ee(t){return t.target}function dn(t){return t.radius}function je(t){return t.startAngle}function Ie(t){return t.endAngle}function Ce(){return 0}function Te(t){var n=Se,r=Ee,e=dn,i=dn,l=je,u=Ie,s=Ce,o=null;function a(){var f,h=n.apply(this,arguments),c=r.apply(this,arguments),d=s.apply(this,arguments)/2,p=Re.call(arguments),y=+e.apply(this,(p[0]=h,p)),x=l.apply(this,p)-xt,M=u.apply(this,p)-xt,v=+i.apply(this,(p[0]=c,p)),g=l.apply(this,p)-xt,m=u.apply(this,p)-xt;if(o||(o=f=In()),d>Dt&&(cn(M-x)>d*2+Dt?M>x?(x+=d,M-=d):(x-=d,M+=d):x=M=(x+M)/2,cn(m-g)>d*2+Dt?m>g?(g+=d,m-=d):(g-=d,m+=d):g=m=(g+m)/2),o.moveTo(y*Gt(x),y*Bt(x)),o.arc(0,0,y,x,M),(x!==g||M!==m)&&(o.quadraticCurveTo(0,0,v*Gt(g),v*Bt(g)),o.arc(0,0,v,g,m)),o.quadraticCurveTo(0,0,y*Gt(x),y*Bt(x)),o.closePath(),f)return o=null,f+""||null}return a.radius=function(f){return arguments.length?(e=i=typeof f=="function"?f:at(+f),a):e},a.sourceRadius=function(f){return arguments.length?(e=typeof f=="function"?f:at(+f),a):e},a.targetRadius=function(f){return arguments.length?(i=typeof f=="function"?f:at(+f),a):i},a.startAngle=function(f){return arguments.length?(l=typeof f=="function"?f:at(+f),a):l},a.endAngle=function(f){return arguments.length?(u=typeof f=="function"?f:at(+f),a):u},a.padAngle=function(f){return arguments.length?(s=typeof f=="function"?f:at(+f),a):s},a.source=function(f){return arguments.length?(n=f,a):n},a.target=function(f){return arguments.length?(r=f,a):r},a.context=function(f){return arguments.length?(o=f??null,a):o},a}function Ge(){return Te()}function Be(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function At(t,n){if(!isFinite(t)||t===0)return null;var r=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"),e=t.slice(0,r);return[e.length>1?e[0]+e.slice(2):e,+t.slice(r+1)]}function lt(t){return t=At(Math.abs(t)),t?t[1]:NaN}function De(t,n){return function(r,e){for(var i=r.length,l=[],u=0,s=t[0],o=0;i>0&&s>0&&(o+s+1>e&&(s=Math.max(1,e-o)),l.push(r.substring(i-=s,i+s)),!((o+=s+1)>e));)s=t[u=(u+1)%t.length];return l.reverse().join(n)}}function Pe(t){return function(n){return n.replace(/[0-9]/g,function(r){return t[+r]})}}var Fe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Nt(t){if(!(n=Fe.exec(t)))throw new Error("invalid format: "+t);var n;return new Kt({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}Nt.prototype=Kt.prototype;function Kt(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Kt.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ze(t){t:for(var n=t.length,r=1,e=-1,i;r<n;++r)switch(t[r]){case".":e=i=r;break;case"0":e===0&&(e=r),i=r;break;default:if(!+t[r])break t;e>0&&(e=0);break}return e>0?t.slice(0,e)+t.slice(i+1):t}var $t;function Le(t,n){var r=At(t,n);if(!r)return $t=void 0,t.toPrecision(n);var e=r[0],i=r[1],l=i-($t=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,u=e.length;return l===u?e:l>u?e+new Array(l-u+1).join("0"):l>0?e.slice(0,l)+"."+e.slice(l):"0."+new Array(1-l).join("0")+At(t,Math.max(0,n+l-1))[0]}function gn(t,n){var r=At(t,n);if(!r)return t+"";var e=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+e:e.length>i+1?e.slice(0,i+1)+"."+e.slice(i+1):e+new Array(i-e.length+2).join("0")}const mn={"%":(t,n)=>(t*100).toFixed(n),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Be,e:(t,n)=>t.toExponential(n),f:(t,n)=>t.toFixed(n),g:(t,n)=>t.toPrecision(n),o:t=>Math.round(t).toString(8),p:(t,n)=>gn(t*100,n),r:gn,s:Le,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function pn(t){return t}var xn=Array.prototype.map,yn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Oe(t){var n=t.grouping===void 0||t.thousands===void 0?pn:De(xn.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",e=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",l=t.numerals===void 0?pn:Pe(xn.call(t.numerals,String)),u=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",o=t.nan===void 0?"NaN":t.nan+"";function a(h,c){h=Nt(h);var d=h.fill,p=h.align,y=h.sign,x=h.symbol,M=h.zero,v=h.width,g=h.comma,m=h.precision,b=h.trim,w=h.type;w==="n"?(g=!0,w="g"):mn[w]||(m===void 0&&(m=12),b=!0,w="g"),(M||d==="0"&&p==="=")&&(M=!0,d="0",p="=");var $=(c&&c.prefix!==void 0?c.prefix:"")+(x==="$"?r:x==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():""),R=(x==="$"?e:/[%p]/.test(w)?u:"")+(c&&c.suffix!==void 0?c.suffix:""),A=mn[w],E=/[defgprs%]/.test(w);m=m===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m));function j(N){var k=$,_=R,B,Q,H;if(w==="c")_=A(N)+_,N="";else{N=+N;var X=N<0||1/N<0;if(N=isNaN(N)?o:A(Math.abs(N),m),b&&(N=ze(N)),X&&+N==0&&y!=="+"&&(X=!1),k=(X?y==="("?y:s:y==="-"||y==="("?"":y)+k,_=(w==="s"&&!isNaN(N)&&$t!==void 0?yn[8+$t/3]:"")+_+(X&&y==="("?")":""),E){for(B=-1,Q=N.length;++B<Q;)if(H=N.charCodeAt(B),48>H||H>57){_=(H===46?i+N.slice(B+1):N.slice(B))+_,N=N.slice(0,B);break}}}g&&!M&&(N=n(N,1/0));var q=k.length+N.length+_.length,D=q<v?new Array(v-q+1).join(d):"";switch(g&&M&&(N=n(D+N,D.length?v-_.length:1/0),D=""),p){case"<":N=k+N+_+D;break;case"=":N=k+D+N+_;break;case"^":N=D.slice(0,q=D.length>>1)+k+N+_+D.slice(q);break;default:N=D+k+N+_;break}return l(N)}return j.toString=function(){return h+""},j}function f(h,c){var d=Math.max(-8,Math.min(8,Math.floor(lt(c)/3)))*3,p=Math.pow(10,-d),y=a((h=Nt(h),h.type="f",h),{suffix:yn[8+d/3]});return function(x){return y(p*x)}}return{format:a,formatPrefix:f}}var yt,Cn,Tn;Ye({thousands:",",grouping:[3],currency:["$",""]});function Ye(t){return yt=Oe(t),Cn=yt.format,Tn=yt.formatPrefix,yt}function He(t){return Math.max(0,-lt(Math.abs(t)))}function Ve(t,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(lt(n)/3)))*3-lt(Math.abs(t)))}function Xe(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,lt(n)-lt(t))+1}function tn(t,n){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(n).domain(t);break}return this}const Mn=Symbol("implicit");function pt(){var t=new on,n=[],r=[],e=Mn;function i(l){let u=t.get(l);if(u===void 0){if(e!==Mn)return e;t.set(l,u=n.push(l)-1)}return r[u%r.length]}return i.domain=function(l){if(!arguments.length)return n.slice();n=[],t=new on;for(const u of l)t.has(u)||t.set(u,n.push(u)-1);return i},i.range=function(l){return arguments.length?(r=Array.from(l),i):r.slice()},i.unknown=function(l){return arguments.length?(e=l,i):e},i.copy=function(){return pt(n,r).unknown(e)},tn.apply(i,arguments),i}function Gn(){var t=pt().unknown(void 0),n=t.domain,r=t.range,e=0,i=1,l,u,s=!1,o=0,a=0,f=.5;delete t.unknown;function h(){var c=n().length,d=i<e,p=d?i:e,y=d?e:i;l=(y-p)/Math.max(1,c-o+a*2),s&&(l=Math.floor(l)),p+=(y-p-l*(c-o))*f,u=l*(1-o),s&&(p=Math.round(p),u=Math.round(u));var x=le(c).map(function(M){return p+l*M});return r(d?x.reverse():x)}return t.domain=function(c){return arguments.length?(n(c),h()):n()},t.range=function(c){return arguments.length?([e,i]=c,e=+e,i=+i,h()):[e,i]},t.rangeRound=function(c){return[e,i]=c,e=+e,i=+i,s=!0,h()},t.bandwidth=function(){return u},t.step=function(){return l},t.round=function(c){return arguments.length?(s=!!c,h()):s},t.padding=function(c){return arguments.length?(o=Math.min(1,a=+c),h()):o},t.paddingInner=function(c){return arguments.length?(o=Math.min(1,c),h()):o},t.paddingOuter=function(c){return arguments.length?(a=+c,h()):a},t.align=function(c){return arguments.length?(f=Math.max(0,Math.min(1,c)),h()):f},t.copy=function(){return Gn(n(),[e,i]).round(s).paddingInner(o).paddingOuter(a).align(f)},tn.apply(h(),arguments)}function qe(t){return function(){return t}}function Ue(t){return+t}var vn=[0,1];function ot(t){return t}function Zt(t,n){return(n-=t=+t)?function(r){return(r-t)/n}:qe(isNaN(n)?NaN:.5)}function Ze(t,n){var r;return t>n&&(r=t,t=n,n=r),function(e){return Math.max(t,Math.min(n,e))}}function We(t,n,r){var e=t[0],i=t[1],l=n[0],u=n[1];return i<e?(e=Zt(i,e),l=r(u,l)):(e=Zt(e,i),l=r(l,u)),function(s){return l(e(s))}}function Qe(t,n,r){var e=Math.min(t.length,n.length)-1,i=new Array(e),l=new Array(e),u=-1;for(t[e]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());++u<e;)i[u]=Zt(t[u],t[u+1]),l[u]=r(n[u],n[u+1]);return function(s){var o=Wn(t,s,1,e)-1;return l[o](i[o](s))}}function Je(t,n){return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ke(){var t=vn,n=vn,r=Qt,e,i,l,u=ot,s,o,a;function f(){var c=Math.min(t.length,n.length);return u!==ot&&(u=Ze(t[0],t[c-1])),s=c>2?Qe:We,o=a=null,h}function h(c){return c==null||isNaN(c=+c)?l:(o||(o=s(t.map(e),n,r)))(e(u(c)))}return h.invert=function(c){return u(i((a||(a=s(n,t.map(e),Lt)))(c)))},h.domain=function(c){return arguments.length?(t=Array.from(c,Ue),f()):t.slice()},h.range=function(c){return arguments.length?(n=Array.from(c),f()):n.slice()},h.rangeRound=function(c){return n=Array.from(c),r=we,f()},h.clamp=function(c){return arguments.length?(u=c?!0:ot,f()):u!==ot},h.interpolate=function(c){return arguments.length?(r=c,f()):r},h.unknown=function(c){return arguments.length?(l=c,h):l},function(c,d){return e=c,i=d,f()}}function tr(){return Ke()(ot,ot)}function nr(t,n,r,e){var i=ie(t,n,r),l;switch(e=Nt(e??",f"),e.type){case"s":{var u=Math.max(Math.abs(t),Math.abs(n));return e.precision==null&&!isNaN(l=Ve(i,u))&&(e.precision=l),Tn(e,u)}case"":case"e":case"g":case"p":case"r":{e.precision==null&&!isNaN(l=Xe(i,Math.max(Math.abs(t),Math.abs(n))))&&(e.precision=l-(e.type==="e"));break}case"f":case"%":{e.precision==null&&!isNaN(l=He(i))&&(e.precision=l-(e.type==="%")*2);break}}return Cn(e)}function er(t){var n=t.domain;return t.ticks=function(r){var e=n();return ae(e[0],e[e.length-1],r??10)},t.tickFormat=function(r,e){var i=n();return nr(i[0],i[i.length-1],r??10,e)},t.nice=function(r){r==null&&(r=10);var e=n(),i=0,l=e.length-1,u=e[i],s=e[l],o,a,f=10;for(s<u&&(a=u,u=s,s=a,a=i,i=l,l=a);f-- >0;){if(a=Vt(u,s,r),a===o)return e[i]=u,e[l]=s,n(e);if(a>0)u=Math.floor(u/a)*a,s=Math.ceil(s/a)*a;else if(a<0)u=Math.ceil(u*a)/a,s=Math.floor(s*a)/a;else break;o=a}return t},t}function W(){var t=tr();return t.copy=function(){return Je(t,W())},tn.apply(t,arguments),er(t)}function rr(t){for(var n=t.length/6|0,r=new Array(n),e=0;e<n;)r[e]="#"+t.slice(e*6,++e*6);return r}const ar=rr("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab");function C(t){return function(){return t}}const bn=Math.abs,F=Math.atan2,nt=Math.cos,ir=Math.max,Pt=Math.min,U=Math.sin,st=Math.sqrt,V=1e-12,gt=Math.PI,_t=gt/2,or=2*gt;function sr(t){return t>1?0:t<-1?gt:Math.acos(t)}function wn(t){return t>=1?_t:t<=-1?-_t:Math.asin(t)}function nn(t){let n=3;return t.digits=function(r){if(!arguments.length)return n;if(r==null)n=null;else{const e=Math.floor(r);if(!(e>=0))throw new RangeError(`invalid digits: ${r}`);n=e}return t},()=>new Jt(n)}function lr(t){return t.innerRadius}function cr(t){return t.outerRadius}function ur(t){return t.startAngle}function fr(t){return t.endAngle}function hr(t){return t&&t.padAngle}function dr(t,n,r,e,i,l,u,s){var o=r-t,a=e-n,f=u-i,h=s-l,c=h*o-f*a;if(!(c*c<V))return c=(f*(n-l)-h*(t-i))/c,[t+c*o,n+c*a]}function Mt(t,n,r,e,i,l,u){var s=t-r,o=n-e,a=(u?l:-l)/st(s*s+o*o),f=a*o,h=-a*s,c=t+f,d=n+h,p=r+f,y=e+h,x=(c+p)/2,M=(d+y)/2,v=p-c,g=y-d,m=v*v+g*g,b=i-l,w=c*y-p*d,$=(g<0?-1:1)*st(ir(0,b*b*m-w*w)),R=(w*g-v*$)/m,A=(-w*v-g*$)/m,E=(w*g+v*$)/m,j=(-w*v+g*$)/m,N=R-x,k=A-M,_=E-x,B=j-M;return N*N+k*k>_*_+B*B&&(R=E,A=j),{cx:R,cy:A,x01:-f,y01:-h,x11:R*(i/b-1),y11:A*(i/b-1)}}function kn(){var t=lr,n=cr,r=C(0),e=null,i=ur,l=fr,u=hr,s=null,o=nn(a);function a(){var f,h,c=+t.apply(this,arguments),d=+n.apply(this,arguments),p=i.apply(this,arguments)-_t,y=l.apply(this,arguments)-_t,x=bn(y-p),M=y>p;if(s||(s=f=o()),d<c&&(h=d,d=c,c=h),!(d>V))s.moveTo(0,0);else if(x>or-V)s.moveTo(d*nt(p),d*U(p)),s.arc(0,0,d,p,y,!M),c>V&&(s.moveTo(c*nt(y),c*U(y)),s.arc(0,0,c,y,p,M));else{var v=p,g=y,m=p,b=y,w=x,$=x,R=u.apply(this,arguments)/2,A=R>V&&(e?+e.apply(this,arguments):st(c*c+d*d)),E=Pt(bn(d-c)/2,+r.apply(this,arguments)),j=E,N=E,k,_;if(A>V){var B=wn(A/c*U(R)),Q=wn(A/d*U(R));(w-=B*2)>V?(B*=M?1:-1,m+=B,b-=B):(w=0,m=b=(p+y)/2),($-=Q*2)>V?(Q*=M?1:-1,v+=Q,g-=Q):($=0,v=g=(p+y)/2)}var H=d*nt(v),X=d*U(v),q=c*nt(b),D=c*U(b);if(E>V){var K=d*nt(g),tt=d*U(g),G=c*nt(m),P=c*U(m),Y;if(x<gt)if(Y=dr(H,X,G,P,K,tt,q,D)){var Et=H-Y[0],jt=X-Y[1],It=K-Y[0],Ct=tt-Y[1],en=1/U(sr((Et*It+jt*Ct)/(st(Et*Et+jt*jt)*st(It*It+Ct*Ct)))/2),rn=st(Y[0]*Y[0]+Y[1]*Y[1]);j=Pt(E,(c-rn)/(en-1)),N=Pt(E,(d-rn)/(en+1))}else j=N=0}$>V?N>V?(k=Mt(G,P,H,X,d,N,M),_=Mt(K,tt,q,D,d,N,M),s.moveTo(k.cx+k.x01,k.cy+k.y01),N<E?s.arc(k.cx,k.cy,N,F(k.y01,k.x01),F(_.y01,_.x01),!M):(s.arc(k.cx,k.cy,N,F(k.y01,k.x01),F(k.y11,k.x11),!M),s.arc(0,0,d,F(k.cy+k.y11,k.cx+k.x11),F(_.cy+_.y11,_.cx+_.x11),!M),s.arc(_.cx,_.cy,N,F(_.y11,_.x11),F(_.y01,_.x01),!M))):(s.moveTo(H,X),s.arc(0,0,d,v,g,!M)):s.moveTo(H,X),!(c>V)||!(w>V)?s.lineTo(q,D):j>V?(k=Mt(q,D,K,tt,c,-j,M),_=Mt(H,X,G,P,c,-j,M),s.lineTo(k.cx+k.x01,k.cy+k.y01),j<E?s.arc(k.cx,k.cy,j,F(k.y01,k.x01),F(_.y01,_.x01),!M):(s.arc(k.cx,k.cy,j,F(k.y01,k.x01),F(k.y11,k.x11),!M),s.arc(0,0,c,F(k.cy+k.y11,k.cx+k.x11),F(_.cy+_.y11,_.cx+_.x11),M),s.arc(_.cx,_.cy,j,F(_.y11,_.x11),F(_.y01,_.x01),!M))):s.arc(0,0,c,b,m,M)}if(s.closePath(),f)return s=null,f+""||null}return a.centroid=function(){var f=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,h=(+i.apply(this,arguments)+ +l.apply(this,arguments))/2-gt/2;return[nt(h)*f,U(h)*f]},a.innerRadius=function(f){return arguments.length?(t=typeof f=="function"?f:C(+f),a):t},a.outerRadius=function(f){return arguments.length?(n=typeof f=="function"?f:C(+f),a):n},a.cornerRadius=function(f){return arguments.length?(r=typeof f=="function"?f:C(+f),a):r},a.padRadius=function(f){return arguments.length?(e=f==null?null:typeof f=="function"?f:C(+f),a):e},a.startAngle=function(f){return arguments.length?(i=typeof f=="function"?f:C(+f),a):i},a.endAngle=function(f){return arguments.length?(l=typeof f=="function"?f:C(+f),a):l},a.padAngle=function(f){return arguments.length?(u=typeof f=="function"?f:C(+f),a):u},a.context=function(f){return arguments.length?(s=f??null,a):s},a}function Bn(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Dn(t){this._context=t}Dn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n);break}}};function Pn(t){return new Dn(t)}function Fn(t){return t[0]}function zn(t){return t[1]}function dt(t,n){var r=C(!0),e=null,i=Pn,l=null,u=nn(s);t=typeof t=="function"?t:t===void 0?Fn:C(t),n=typeof n=="function"?n:n===void 0?zn:C(n);function s(o){var a,f=(o=Bn(o)).length,h,c=!1,d;for(e==null&&(l=i(d=u())),a=0;a<=f;++a)!(a<f&&r(h=o[a],a,o))===c&&((c=!c)?l.lineStart():l.lineEnd()),c&&l.point(+t(h,a,o),+n(h,a,o));if(d)return l=null,d+""||null}return s.x=function(o){return arguments.length?(t=typeof o=="function"?o:C(+o),s):t},s.y=function(o){return arguments.length?(n=typeof o=="function"?o:C(+o),s):n},s.defined=function(o){return arguments.length?(r=typeof o=="function"?o:C(!!o),s):r},s.curve=function(o){return arguments.length?(i=o,e!=null&&(l=i(e)),s):i},s.context=function(o){return arguments.length?(o==null?e=l=null:l=i(e=o),s):e},s}function An(t,n,r){var e=null,i=C(!0),l=null,u=Pn,s=null,o=nn(a);t=typeof t=="function"?t:t===void 0?Fn:C(+t),n=typeof n=="function"?n:C(n===void 0?0:+n),r=typeof r=="function"?r:r===void 0?zn:C(+r);function a(h){var c,d,p,y=(h=Bn(h)).length,x,M=!1,v,g=new Array(y),m=new Array(y);for(l==null&&(s=u(v=o())),c=0;c<=y;++c){if(!(c<y&&i(x=h[c],c,h))===M)if(M=!M)d=c,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),p=c-1;p>=d;--p)s.point(g[p],m[p]);s.lineEnd(),s.areaEnd()}M&&(g[c]=+t(x,c,h),m[c]=+n(x,c,h),s.point(e?+e(x,c,h):g[c],r?+r(x,c,h):m[c]))}if(v)return s=null,v+""||null}function f(){return dt().defined(i).curve(u).context(l)}return a.x=function(h){return arguments.length?(t=typeof h=="function"?h:C(+h),e=null,a):t},a.x0=function(h){return arguments.length?(t=typeof h=="function"?h:C(+h),a):t},a.x1=function(h){return arguments.length?(e=h==null?null:typeof h=="function"?h:C(+h),a):e},a.y=function(h){return arguments.length?(n=typeof h=="function"?h:C(+h),r=null,a):n},a.y0=function(h){return arguments.length?(n=typeof h=="function"?h:C(+h),a):n},a.y1=function(h){return arguments.length?(r=h==null?null:typeof h=="function"?h:C(+h),a):r},a.lineX0=a.lineY0=function(){return f().x(t).y(n)},a.lineY1=function(){return f().x(t).y(r)},a.lineX1=function(){return f().x(e).y(n)},a.defined=function(h){return arguments.length?(i=typeof h=="function"?h:C(!!h),a):i},a.curve=function(h){return arguments.length?(u=h,l!=null&&(s=u(l)),a):u},a.context=function(h){return arguments.length?(h==null?l=s=null:s=u(l=h),a):l},a}function Ln(t,n){this._context=t,this._t=n}Ln.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(t,n);else{var r=this._x*(1-this._t)+t*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,n)}break}}this._x=t,this._y=n}};function ct(t){return new Ln(t,.5)}function On(t){if(!t)return null;const n=t.trim().match(/^(\d+)\s*min/i);return n?Number(n[1]):null}function _r(t,n,r){const e=r==="imdb"?"IMDB_Rating":"Meta_score",i=[],l=new Map;for(const s of t){const o=Number(s.Released_Year),a=Number(s[e]);Number.isNaN(o)||Number.isNaN(a)||(l.has(o)||l.set(o,[]),l.get(o).push(a))}const u=[...l.entries()].sort((s,o)=>s[0]-o[0]).map(([s,o])=>({year:s,value:o.reduce((a,f)=>a+f,0)/o.length}));i.push({key:"All",values:u});for(const s of n){const o=new Map;for(const f of t){if(f[s]!=="true")continue;const h=Number(f.Released_Year),c=Number(f[e]);Number.isNaN(h)||Number.isNaN(c)||(o.has(h)||o.set(h,[]),o.get(h).push(c))}const a=[...o.entries()].sort((f,h)=>f[0]-h[0]).map(([f,h])=>({year:f,value:h.reduce((c,d)=>c+d,0)/h.length}));a.length>0&&i.push({key:s,values:a})}return i}function Rr(t,n="imdb"){const r=n==="imdb"?"IMDB_Rating":"Meta_score",e=[];for(const i of t){const l=On(i.Runtime??""),u=Number(i[r]),s=Number(i.Released_Year),a=(i.Genre??"").split(",")[0]?.trim()??"Other";l==null||Number.isNaN(u)||Number.isNaN(s)||e.push({runtime:l,rating:u,genre:a,year:s})}return e}function Sr(t,n="imdb"){const r=n==="imdb"?"IMDB_Rating":"Meta_score",e=new Map;for(const i of t){const l=On(i.Runtime??""),u=Number(i[r]),o=(i.Genre??"").split(",")[0]?.trim()??"Other";l==null||Number.isNaN(u)||(e.has(o)||e.set(o,{runtime:[],rating:[]}),e.get(o).runtime.push(l),e.get(o).rating.push(u))}return[...e.entries()].map(([i,{runtime:l,rating:u}])=>({genre:i,runtime:l.reduce((s,o)=>s+o,0)/l.length,rating:u.reduce((s,o)=>s+o,0)/u.length,count:l.length})).sort((i,l)=>i.genre.localeCompare(l.genre))}function Nn(t){if(t==="All")return"All";const n=t.startsWith("is")?t.slice(2):t;return n.charAt(0).toUpperCase()+n.slice(1)}function Er(t){const n=[];for(const r of t){const e=Number(r.Meta_score?.trim()),i=Number(r.IMDB_Rating?.trim()),u=(r.Genre??"").split(",")[0]?.trim()??"Other",s=r.Series_Title??"Unknown";Number.isNaN(e)||Number.isNaN(i)||n.push({meta:e,imdb:i,genre:u,title:s})}return n}const Yn=t=>(t-1)/9*100;function jr(t){const n=new Map;for(const r of t){const e=Number(r.Meta_score?.trim()),i=Number(r.IMDB_Rating?.trim()),l=Number(r.Released_Year);if(Number.isNaN(e)||Number.isNaN(i)||Number.isNaN(l))continue;const u=Yn(i),s=u-e;n.has(l)||n.set(l,{metas:[],imdbRescaled:[],gaps:[]});const o=n.get(l);o.metas.push(e),o.imdbRescaled.push(u),o.gaps.push(s)}return[...n.entries()].sort((r,e)=>r[0]-e[0]).map(([r,{metas:e,imdbRescaled:i,gaps:l}])=>{const u=e.reduce((o,a)=>o+a,0)/e.length,s=i.reduce((o,a)=>o+a,0)/i.length;return{year:r,meanGap:l.reduce((o,a)=>o+a,0)/l.length,meanMeta:u,meanImdbRescaled:s,meanAvg:(u+s)/2,count:l.length}})}function Ir(t){const n=new Map;for(const r of t){const e=Number(r.Meta_score?.trim()),i=Number(r.IMDB_Rating?.trim()),u=(r.Genre??"").split(",")[0]?.trim()??"Other";if(Number.isNaN(e)||Number.isNaN(i))continue;const s=Yn(i)-e;n.has(u)||n.set(u,[]),n.get(u).push(s)}return[...n.entries()].map(([r,e])=>({genre:r,meanGap:e.reduce((i,l)=>i+l,0)/e.length,count:e.length})).sort((r,e)=>r.meanGap-e.meanGap)}function gr(t,n){const r=Math.min(t.length,n.length);if(r<2)return 0;const e=t.reduce((a,f)=>a+f,0)/r,i=n.reduce((a,f)=>a+f,0)/r;let l=0,u=0,s=0;for(let a=0;a<r;a++){const f=t[a]-e,h=n[a]-i;l+=f*h,u+=f*f,s+=h*h}const o=Math.sqrt(u*s);return o<1e-10?0:l/o}function mr(t,n){const r=Math.min(t.length,n.length);if(r<2)return{slope:0,intercept:0};const e=t.reduce((a,f)=>a+f,0)/r,i=n.reduce((a,f)=>a+f,0)/r;let l=0,u=0;for(let a=0;a<r;a++){const f=t[a]-e;l+=f*(n[a]-i),u+=f*f}const s=u<1e-10?0:l/u,o=i-s*e;return{slope:s,intercept:o}}const I=928,it=500,ut=600,S={top:25,right:30,bottom:35,left:45},Rt=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"];function $n(t,n){return t==="All"?"#333":Rt[n%Rt.length]}function Cr({series:t,visibleKeys:n,metric:r,domain:e}){const i=L.useRef(null),l=L.useRef(null);L.useEffect(()=>{if(!l.current||!i.current||t.length===0)return;const s=t.filter(A=>n.has(A.key));if(s.length===0)return;const o=s.flatMap(A=>A.values.map(E=>E.year)),a=s.flatMap(A=>A.values.map(E=>E.value)),f=Math.min(...o),h=Math.max(...o),c=Math.min(...a),d=Math.max(...a),p=e&&!Number.isNaN(e.xMin)?e.xMin:f,y=e&&!Number.isNaN(e.xMax)?e.xMax:h,x=e&&!Number.isNaN(e.yMin)?e.yMin:c,M=e&&!Number.isNaN(e.yMax)?e.yMax:d,v=W().domain([p,y]).range([S.left,I-S.right]),g=W().domain([x,M]).range([it-S.bottom,S.top]),m=dt().x(A=>v(A.year)).y(A=>g(A.value));O(l.current).selectAll("*").remove();const b=O(l.current).attr("viewBox",[0,0,I,it]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;").style("overflow","visible").style("-webkit-tap-highlight-color","transparent");b.append("g").attr("transform",`translate(0,${it-S.bottom})`).call(St(v).ticks(Math.min(20,y-p+1)).tickSizeOuter(0)),b.append("g").attr("transform",`translate(${S.left},0)`).call(mt(g).ticks(it/50)).call(A=>A.select(".domain").remove()).call(A=>A.selectAll(".tick line").clone().attr("x2",I-S.left-S.right).attr("stroke-opacity",.1)).call(A=>A.append("text").attr("x",-45).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text(`↑ Avg ${r==="imdb"?"IMDB Rating":"Meta score"}`)),s.forEach((A,E)=>{const j=$n(A.key,E);b.append("path").attr("fill","none").attr("stroke",j).attr("stroke-width",A.key==="All"?2.5:1.5).attr("d",m(A.values)??"")});const w=b.append("g").attr("pointer-events","none").style("display","none");function $(A){const E=kt(A)[0],j=v.invert(E);w.style("display",null);const N=s.flatMap(G=>G.values.map(P=>P.year)),k=[...new Set(N)].sort((G,P)=>G-P),_=Qn(k,j),B=k[Math.max(0,Math.min(_,k.length-1))]??k[0],Q=v(B),H=s.find(G=>G.values.some(P=>P.year===B)),X=H?g(H.values.find(G=>G.year===B).value):it/2;w.attr("transform",`translate(${Q},${X})`);const q=[`Year: ${B}`];s.forEach(G=>{const P=G.values.find(Y=>Y.year===B);P&&q.push(`${Nn(G.key)}: ${P.value.toFixed(2)}`)});const D=w.selectAll("path").data([1]).join("path").attr("fill","white").attr("stroke","black").attr("stroke-width",1),K=w.selectAll("text").data([1]).join("text").call(G=>G.selectAll("tspan").data(q).join("tspan").attr("x",0).attr("y",(P,Y)=>`${Y*1.1}em`).attr("font-weight",(P,Y)=>Y===0?"bold":null).text(P=>P)),tt=K.node();if(tt){const G=tt.getBBox();K.attr("transform",`translate(${-G.width/2},${15-G.y})`),D.attr("d",`M${-G.width/2-10},5H-5l5,-5l5,5H${G.width/2+10}v${G.height+20}h-${G.width+20}z`)}}function R(){w.style("display","none")}return b.on("pointerenter pointermove",$).on("pointerleave",R),()=>{b.on("pointerenter pointermove",null).on("pointerleave",null)}},[t,n,r,e]);const u=t.filter(s=>n.has(s.key));return T.jsxs("div",{ref:i,className:"flex flex-col gap-2",children:[T.jsx("svg",{ref:l,width:I,height:it,className:"overflow-visible"}),T.jsx("div",{className:"flex flex-wrap gap-4 text-xs",children:u.map((s,o)=>T.jsxs("span",{className:"flex items-center gap-1.5",children:[T.jsx("span",{className:"inline-block h-0.5 w-4 rounded",style:{backgroundColor:$n(s.key,o),height:s.key==="All"?3:2}}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:Nn(s.key)})]},s.key))})]})}function Tr({points:t,pointsByGenre:n,selectedYear:r,showAllMovies:e=!1,metric:i="imdb"}){const l=L.useRef(null),u=r!=null&&!e,s=e?t:u?t.filter(c=>c.year===r):n.map(c=>({...c,year:0})),o=[...new Set(s.map(c=>c.genre))].sort(),a=pt().domain(o).range(Rt),f=e||u?J(t,c=>c.runtime):J(n,c=>c.runtime),h=e||u?J(t,c=>c.rating):J(n,c=>c.rating);return L.useEffect(()=>{if(!l.current)return;const c=W().domain(f).nice().range([S.left,I-S.right]),d=W().domain(h).nice().range([ut-S.bottom,S.top]);O(l.current).selectAll("*").remove();const p=O(l.current).attr("viewBox",[0,0,I,ut]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;").style("overflow","visible");p.append("g").attr("transform",`translate(0,${ut-S.bottom})`).call(St(c).ticks(I/80)).call(x=>x.select(".domain").remove()).call(x=>x.append("text").attr("x",I).attr("y",S.bottom-4).attr("fill","currentColor").attr("text-anchor","end").text("Runtime (min) →")),p.append("g").attr("transform",`translate(${S.left},0)`).call(mt(d)).call(x=>x.select(".domain").remove()).call(x=>x.append("text").attr("x",-45).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text(i==="imdb"?"↑ IMDB Rating":"↑ Meta score")),p.append("g").attr("stroke","currentColor").attr("stroke-opacity",.1).call(x=>x.append("g").selectAll("line").data(c.ticks()).join("line").attr("x1",M=>.5+c(M)).attr("x2",M=>.5+c(M)).attr("y1",S.top).attr("y2",ut-S.bottom)).call(x=>x.append("g").selectAll("line").data(d.ticks()).join("line").attr("y1",M=>.5+d(M)).attr("y2",M=>.5+d(M)).attr("x1",S.left).attr("x2",I-S.right));const y=p.append("g").attr("pointer-events","none").style("display","none");p.append("g").selectAll("circle").data(s.length>0?s:[]).join("circle").attr("cx",x=>c(x.runtime)).attr("cy",x=>d(x.rating)).attr("r",u||e?3.5:6).attr("fill",x=>a(x.genre)).attr("stroke","#333").attr("stroke-width",.5).style("cursor","pointer").on("pointerenter pointermove",function(x,M){y.style("display",null);const[v,g]=kt(x);y.attr("transform",`translate(${v+12},${g+12})`);const m=i==="imdb"?"IMDB":"Meta",b=u||e?[...u?[`Year: ${M.year}`]:[],`Runtime: ${M.runtime.toFixed(0)} min`,`${m}: ${M.rating.toFixed(1)}`,`Genre: ${M.genre}`]:[`Genre: ${M.genre}`,`Avg runtime: ${M.runtime.toFixed(0)} min`,`Avg ${m.toLowerCase()} rating: ${M.rating.toFixed(2)}`,`Movies: ${"count"in M?M.count:""}`],w=y.selectAll("path").data([1]).join("path").attr("fill","white").attr("stroke","black").attr("stroke-width",1),$=y.selectAll("text").data([1]).join("text").call(A=>A.selectAll("tspan").data(b).join("tspan").attr("x",0).attr("y",(E,j)=>`${j*1.1}em`).attr("font-weight",(E,j)=>j===0?"bold":null).text(E=>E)),R=$.node();if(R&&R.getBBox){const A=R.getBBox();$.attr("transform",`translate(0,${-A.y})`),w.attr("d",`M0,0h${A.width+16}v${A.height+12}h-${A.width+16}z`)}}).on("pointerleave",()=>{y.style("display","none")})},[s,r,f,h,u,e,i]),T.jsxs("div",{className:"flex flex-col gap-2",children:[T.jsx("svg",{ref:l,width:I,height:ut,className:"overflow-visible"}),T.jsx("div",{className:"flex flex-wrap gap-4 text-xs",children:o.map(c=>T.jsxs("span",{className:"flex items-center gap-1.5",children:[T.jsx("span",{className:"inline-block h-3 w-3 rounded-full border border-gray-700",style:{backgroundColor:a(c)}}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:c})]},c))})]})}const ft=560;function Gr({points:t}){const n=L.useRef(null),r=L.useMemo(()=>[...new Set(t.map(o=>o.genre))].sort(),[t]),e=pt().domain(r).range(Rt),i=L.useMemo(()=>gr(t.map(o=>o.meta),t.map(o=>o.imdb)),[t]),l=L.useMemo(()=>{const o=new Map;for(const a of r){const f=t.filter(h=>h.genre===a);if(f.length>=2){const h=f.map(d=>d.meta),c=f.map(d=>d.imdb);o.set(a,mr(h,c))}}return o},[t,r]),u=J(t,o=>o.meta),s=J(t,o=>o.imdb);return L.useEffect(()=>{if(!n.current||t.length===0)return;const o=W().domain(u).nice().range([S.left,I-S.right]),a=W().domain(s).nice().range([ft-S.bottom,S.top]);O(n.current).selectAll("*").remove();const f=O(n.current).attr("viewBox",[0,0,I,ft]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;").style("overflow","visible");f.append("g").attr("transform",`translate(0,${ft-S.bottom})`).call(St(o).ticks(I/80)).call(p=>p.select(".domain").remove()).call(p=>p.append("text").attr("x",I).attr("y",S.bottom-4).attr("fill","currentColor").attr("text-anchor","end").text("Meta score (critics) →")),f.append("g").attr("transform",`translate(${S.left},0)`).call(mt(a)).call(p=>p.select(".domain").remove()).call(p=>p.append("text").attr("x",-45).attr("y",10).attr("fill","currentColor").attr("text-anchor","start").text("↑ IMDB Rating (audiences)")),f.append("g").attr("stroke","currentColor").attr("stroke-opacity",.1).call(p=>p.append("g").selectAll("line").data(o.ticks()).join("line").attr("x1",y=>.5+o(y)).attr("x2",y=>.5+o(y)).attr("y1",S.top).attr("y2",ft-S.bottom)).call(p=>p.append("g").selectAll("line").data(a.ticks()).join("line").attr("y1",y=>.5+a(y)).attr("y2",y=>.5+a(y)).attr("x1",S.left).attr("x2",I-S.right));const h=f.append("g").attr("pointer-events","none").style("display","none"),c=o.domain()[0]??0,d=o.domain()[1]??100;l.forEach((p,y)=>{const x=p.slope*c+p.intercept,M=p.slope*d+p.intercept,v=f.append("g").attr("class","trend-line-group").style("cursor","pointer");v.append("line").attr("x1",o(c)).attr("x2",o(d)).attr("y1",a(x)).attr("y2",a(M)).attr("stroke","transparent").attr("stroke-width",16),v.append("line").attr("x1",o(c)).attr("x2",o(d)).attr("y1",a(x)).attr("y2",a(M)).attr("stroke",e(y)).attr("stroke-width",2).attr("stroke-dasharray","4,4").attr("opacity",.85),v.append("title").text(`${y} trend line`),v.on("pointerenter pointermove",function(g){h.style("display",null);const[m,b]=kt(g);h.attr("transform",`translate(${m+12},${b+12})`);const w=h.selectAll("path").data([1]).join("path").attr("fill","white").attr("stroke","black").attr("stroke-width",1),$=h.selectAll("text").data([1]).join("text").call(A=>A.selectAll("tspan").data([`${y} (trend line)`]).join("tspan").attr("x",0).attr("y",0).attr("font-weight","bold").text(E=>E)),R=$.node();if(R&&R.getBBox){const A=R.getBBox();$.attr("transform",`translate(0,${-A.y})`),w.attr("d",`M0,0h${A.width+16}v${A.height+12}h-${A.width+16}z`)}}),v.on("pointerleave",()=>h.style("display","none"))}),f.append("g").selectAll("circle").data(t).join("circle").attr("cx",p=>o(p.meta)).attr("cy",p=>a(p.imdb)).attr("r",3.5).attr("fill",p=>e(p.genre)).attr("stroke","#333").attr("stroke-width",.5).style("cursor","pointer").on("pointerenter pointermove",function(p,y){h.style("display",null);const[x,M]=kt(p);h.attr("transform",`translate(${x+12},${M+12})`);const v=[y.title,`Meta: ${y.meta.toFixed(0)}`,`IMDB: ${y.imdb.toFixed(1)}`,y.genre],g=h.selectAll("path").data([1]).join("path").attr("fill","white").attr("stroke","black").attr("stroke-width",1),m=h.selectAll("text").data([1]).join("text").call(w=>w.selectAll("tspan").data(v).join("tspan").attr("x",0).attr("y",($,R)=>`${R*1.1}em`).attr("font-weight",($,R)=>R===0?"bold":null).text($=>$)),b=m.node();if(b&&b.getBBox){const w=b.getBBox();m.attr("transform",`translate(0,${-w.y})`),g.attr("d",`M0,0h${w.width+16}v${w.height+12}h-${w.width+16}z`)}}).on("pointerleave",()=>{h.style("display","none")})},[t,u,s,r,l]),T.jsxs("div",{className:"flex flex-col gap-2",children:[T.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Pearson r = ",i.toFixed(3),". Dashed lines = linear trend per genre (IMDB on Meta); colors match legend. Points above a genre’s line = audiences rate higher than critics for that genre; below = critics rate higher."]}),T.jsx("svg",{ref:n,width:I,height:ft,className:"overflow-visible"}),T.jsx("div",{className:"flex flex-wrap gap-4 text-xs",children:r.map(o=>T.jsxs("span",{className:"flex items-center gap-1.5",children:[T.jsx("span",{className:"inline-block h-3 w-3 rounded-full border border-gray-700",style:{backgroundColor:e(o)}}),T.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:o})]},o))})]})}const _n=420,pr=22,z={top:24,right:50,bottom:16,left:90},Ft="#e6550d",zt="#3182bd";function Br({data:t}){const n=L.useRef(null),r=J(t,l=>l.year),e=[Math.min(se(t,l=>Math.min(l.meanMeta,l.meanImdbRescaled))??0,0),Math.max(oe(t,l=>Math.max(l.meanMeta,l.meanImdbRescaled))??100,100)],i=_n;return L.useEffect(()=>{if(!n.current||t.length===0)return;const l=W().domain(r).range([S.left,I-S.right]),u=W().domain(e).range([i-S.bottom,S.top]);O(n.current).selectAll("*").remove();const s=O(n.current).attr("viewBox",[0,0,I,i]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;").style("overflow","visible");s.append("g").attr("transform",`translate(0,${i-S.bottom})`).call(St(l).ticks(I/80).tickSizeOuter(0)).call(a=>a.select(".domain").remove()),s.append("g").attr("transform",`translate(${S.left},0)`).call(mt(u)).call(a=>a.select(".domain").remove()).call(a=>a.selectAll(".tick line").clone().attr("x2",I-S.left-S.right).attr("stroke-opacity",.1)).call(a=>a.select(".tick:last-of-type text").clone().attr("x",-45).attr("y",-24).attr("fill","currentColor").attr("text-anchor","start").text("↑ Score (0–100)")),s.append("path").attr("fill",Ft).attr("fill-opacity",.4).attr("d",An().curve(ct).x(a=>l(a.year)).y0(a=>u(a.meanAvg)).y1(a=>u(a.meanImdbRescaled))(t)),s.append("path").attr("fill",zt).attr("fill-opacity",.4).attr("d",An().curve(ct).x(a=>l(a.year)).y0(a=>u(a.meanAvg)).y1(a=>u(a.meanMeta))(t)),s.append("path").attr("fill","none").attr("stroke","black").attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",dt().curve(ct).x(a=>l(a.year)).y(a=>u(a.meanAvg))(t)),s.append("path").attr("fill","none").attr("stroke",Ft).attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",dt().curve(ct).x(a=>l(a.year)).y(a=>u(a.meanImdbRescaled))(t)),s.append("path").attr("fill","none").attr("stroke",zt).attr("stroke-width",1.5).attr("stroke-dasharray","4,3").attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",dt().curve(ct).x(a=>l(a.year)).y(a=>u(a.meanMeta))(t)),s.append("g").selectAll("circle").data(t).join("circle").attr("cx",a=>l(a.year)).attr("cy",a=>u(a.meanAvg)).attr("r",3).attr("fill","black").attr("stroke","white").attr("stroke-width",1).append("title").text(a=>`${a.year}: avg ${a.meanAvg.toFixed(1)}, IMDB ${a.meanImdbRescaled.toFixed(1)}, Meta ${a.meanMeta.toFixed(1)} (n=${a.count})`);const o=s.append("g").attr("transform",`translate(${I-S.right-160},${S.top})`);o.append("line").attr("x1",0).attr("x2",20).attr("y1",0).attr("y2",0).attr("stroke","black").attr("stroke-width",1.5),o.append("text").attr("x",24).attr("y",4).text("Average (both)"),o.append("line").attr("x1",0).attr("x2",20).attr("y1",16).attr("y2",16).attr("stroke",Ft).attr("stroke-width",1.5),o.append("text").attr("x",24).attr("y",20).text("IMDB (audiences, 0–100)"),o.append("line").attr("x1",0).attr("x2",20).attr("y1",32).attr("y2",32).attr("stroke",zt).attr("stroke-dasharray","4,3").attr("stroke-width",1.5),o.append("text").attr("x",24).attr("y",36).text("Meta (critics, 0–100)")},[t,r,e]),T.jsx("svg",{ref:n,width:I,height:_n,className:"overflow-visible"})}const xr="#3182bd",yr="#e34a33",Mr="#22c55e",vr="#eab308",br="#e34a33";function wr(t){return t.meanGap>0?xr:yr}function kr(t){const n=Math.abs(t.meanGap);return n<2?Mr:n<4?vr:br}const Ar=100;function Nr(t){return .4+.6*Math.max(0,Math.min(1,t.count/Ar))}const Rn=3;function Dr({data:t,showCount:n=!0,caption:r,barOutline:e=!1,opacityByCount:i=!1,boldLabelsByGap:l=!1,boldCountWhenOne:u=!1,highlightZeroLine:s=!1,colorBarsByMagnitude:o=!1}){const a=L.useRef(null),f=J(t,d=>d.meanGap),h=[Math.min(f[0],0),Math.max(f[1],0)],c=Math.ceil((t.length+.1)*pr)+z.top+z.bottom;return L.useEffect(()=>{if(!a.current||t.length===0)return;const d=W().domain(h).rangeRound([z.left,I-z.right]),p=Gn().domain(t.map(g=>g.genre)).rangeRound([z.top,c-z.bottom]).padding(.1);O(a.current).selectAll("*").remove();const y=O(a.current).attr("viewBox",[0,0,I,c]).attr("style","max-width: 100%; height: auto; font: 10px sans-serif;").style("overflow","visible"),x=y.append("g").selectAll("rect").data(t).join("rect").attr("fill",g=>o?kr(g):wr(g)).attr("x",g=>d(Math.min(g.meanGap,0))).attr("y",g=>p(g.genre)).attr("width",g=>Math.abs(d(g.meanGap)-d(0))).attr("height",p.bandwidth());i&&x.attr("fill-opacity",g=>Nr(g)),e&&x.attr("stroke","currentColor").attr("stroke-width",1).attr("stroke-opacity",.4);const M=y.append("g").attr("font-size",10).selectAll("text").data(t).join("text").attr("text-anchor",g=>g.meanGap<0?"end":"start").attr("x",g=>d(g.meanGap)+(g.meanGap<0?-4:4)).attr("y",g=>p(g.genre)+p.bandwidth()/2).attr("dy","0.35em");M.each(function(g){const m=O(this);u&&n&&g.count===1?(m.append("tspan").text(`${g.meanGap>=0?"+":""}${g.meanGap.toFixed(1)} (n=`),m.append("tspan").attr("font-weight","bold").text("1"),m.append("tspan").text(")")):m.text(n?`${g.meanGap>=0?"+":""}${g.meanGap.toFixed(1)} (n=${g.count})`:`${g.meanGap>=0?"+":""}${g.meanGap.toFixed(1)}`)}),l&&M.attr("font-weight",g=>Math.abs(g.meanGap)>=Rn?"bold":"normal"),y.append("g").attr("transform",`translate(0,${z.top})`).call(me(d).ticks(I/80).tickFormat(g=>Number(g)>=0?`+${g}`:`${g}`)).call(g=>g.selectAll(".tick line").clone().attr("y2",c-z.top-z.bottom).attr("stroke-opacity",.1)).call(g=>g.select(".domain").remove());const v=y.append("g").attr("transform",`translate(${d(0)},0)`).call(mt(p).tickSize(0).tickPadding(6));if(v.selectAll(".tick text").filter((g,m)=>t[m].meanGap<0).attr("text-anchor","start").attr("x",6),l&&v.selectAll(".tick").each(function(g,m){const b=t[m];O(this).select("text").attr("font-weight",b&&Math.abs(b.meanGap)>=Rn?"bold":"normal")}),s){const g=d(0);y.append("line").attr("x1",g).attr("x2",g).attr("y1",z.top).attr("y2",c-z.bottom).attr("stroke","currentColor").attr("stroke-width",2).attr("stroke-opacity",.5),y.append("text").attr("x",g).attr("y",z.top-6).attr("text-anchor","middle").attr("font-size",9).attr("fill","currentColor").text("0"),y.append("text").attr("x",z.left).attr("y",c-z.bottom+14).attr("text-anchor","start").attr("font-size",9).attr("fill","currentColor").attr("opacity",.7).text("Critics higher ←"),y.append("text").attr("x",I-z.right).attr("y",c-z.bottom+14).attr("text-anchor","end").attr("font-size",9).attr("fill","currentColor").attr("opacity",.7).text("→ Audiences higher")}},[t,h,c,n,e,i,l,u,s,o]),T.jsxs("div",{className:"flex flex-col gap-1",children:[r!==null&&T.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:r??"Blue = audiences rate higher than critics on average; red = critics rate higher. Sorted by mean gap. n = number of movies in that genre (with Meta score)."}),T.jsx("svg",{ref:a,width:I,height:c,className:"overflow-visible"})]})}function Pr(t,n){const{yearMin:r,yearMax:e,minConnectionSize:i}=n,l=t.filter(v=>{const g=Number(v.Released_Year);return!Number.isNaN(g)&&g>=r&&g<=e}),u=new Map;for(const v of l){const g=[v.Star1,v.Star2,v.Star3,v.Star4].map(b=>b?.trim()).filter(b=>!!b),m=v.Series_Title??"";if(m)for(let b=0;b<g.length;b++){const w=g[b];for(let $=b+1;$<g.length;$++){const R=g[$];if(w===R)continue;const A=[w,R].sort().join("|"),E=u.get(A);E?(E.count+=1,E.movies.includes(m)||E.movies.push(m)):u.set(A,{count:1,movies:[m]})}}}const s=[...u.values()].map(v=>v.count),o=s.length>0?Math.min(...s):1,a=s.length>0?Math.max(...s):1,f=new Map;for(const[v,g]of u)g.count>=i&&f.set(v,g);const h=new Map;for(const[v,g]of f){const[m,b]=v.split("|");h.set(m,(h.get(m)??0)+g.count),h.set(b,(h.get(b)??0)+g.count)}const c=[...h.entries()].sort((v,g)=>g[1]-v[1]).map(([v])=>v);if(c.length<2)return{matrix:[],actors:[],connectionCountMin:o,connectionCountMax:a,connectionMovies:new Map,allFilteredMovieIds:[]};const d=new Map(c.map((v,g)=>[v,g])),p=c.length,y=Array.from({length:p},()=>Array(p).fill(0)),x=new Map,M=new Set;for(const[v,g]of f){const[m,b]=v.split("|"),w=d.get(m),$=d.get(b);if(!(w==null||$==null)){y[w][$]=g.count,y[$][w]=g.count,x.set(v,g.movies);for(const R of g.movies)M.add(R)}}return{matrix:y,actors:c,connectionCountMin:o,connectionCountMax:a,connectionMovies:x,allFilteredMovieIds:[...M]}}function Fr(t,n,r){const e=t.filter(o=>{const a=Number(o.Released_Year);return!Number.isNaN(a)&&a>=n&&a<=r}),i=new Map;for(const o of e){const a=[o.Star1,o.Star2,o.Star3,o.Star4].map(f=>f?.trim()).filter(f=>!!f);for(let f=0;f<a.length;f++){const h=a[f];for(let c=f+1;c<a.length;c++){const d=a[c];if(h===d)continue;const p=[h,d].sort().join("|");i.set(p,(i.get(p)??0)+1)}}}const l=[...i.values()],u=l.length>0?Math.max(2,Math.min(...l)):2,s=l.length>0?Math.max(...l):2;return{min:u,max:s}}function zr(t,n){const r=t.actors.filter(c=>n.has(c));if(r.length<2)return{matrix:[],actors:[],connectionCountMin:1,connectionCountMax:1,connectionMovies:new Map,allFilteredMovieIds:[]};const e=new Map(t.actors.map((c,d)=>[c,d])),i=new Map(r.map((c,d)=>[c,d])),l=r.length,u=Array.from({length:l},()=>Array(l).fill(0)),s=new Map,o=new Set;for(let c=0;c<r.length;c++)for(let d=c+1;d<r.length;d++){const p=r[c],y=r[d],x=[p,y].sort().join("|"),M=e.get(p),v=e.get(y),g=t.matrix[M]?.[v]??0;if(g>0){u[i.get(p)][i.get(y)]=g,u[i.get(y)][i.get(p)]=g;const m=t.connectionMovies.get(x)??[];s.set(x,m);for(const b of m)o.add(b)}}const a=u.flat().filter(c=>c>0),f=a.length>0?Math.min(...a):1,h=a.length>0?Math.max(...a):1;return{matrix:u,actors:r,connectionCountMin:f,connectionCountMax:h,connectionMovies:s,allFilteredMovieIds:[...o]}}const Z=600,et=80;function Lr({data:t,onConnectionClick:n,selectedConnection:r}){const e=L.useRef(null);return L.useEffect(()=>{if(!e.current||t.actors.length<2)return;const i=Z/2-55,l=Ae().padAngle(.03).sortGroups(Ht).sortChords(Ht),u=Ge().radius(i),s=pt().domain(t.actors).range(ar),o=kn().innerRadius(i-12).outerRadius(i),a=l(t.matrix),f=Array.isArray(a)?a:[],h="groups"in a?a.groups:[];O(e.current).selectAll("*").remove();const c=Z+et*2,d=O(e.current).attr("viewBox",[-et,-et,c,c]).attr("style","max-width: 100%; height: auto; font: 11px sans-serif;").style("overflow","visible"),p=d.append("g").attr("transform",`translate(${Z/2},${Z/2})`),y=m=>{const b=Ot(s(m));return b?b.darker(1).toString():"#333"},x=m=>{const b=s(t.actors[m.source.index]??""),w=s(t.actors[m.target.index]??"");return Yt(b,w)(.5)},M=m=>{const b=t.actors[m.source.index]??"",w=t.actors[m.target.index]??"";return[b,w].sort().join("|")},v=m=>r?M(m)===[r.actorA,r.actorB].sort().join("|"):!1;p.append("g").selectAll("path").data(f).join("path").attr("fill",x).attr("fill-opacity",m=>v(m)?1:.67).attr("stroke",m=>v(m)?"#333":"rgba(0,0,0,0.15)").attr("stroke-width",m=>v(m)?2:.5).attr("d",u).style("cursor","pointer").on("click",function(m,b){const w=t.actors[b.source.index]??"",$=t.actors[b.target.index]??"";n?.(w,$)}).on("pointerenter",function(m,b){O(this).attr("fill-opacity",1).raise();const w=t.actors[b.source.index]??"",$=t.actors[b.target.index]??"",R=Math.max(b.source.value,b.target.value);d.append("g").attr("pointer-events","none").attr("class","chord-tooltip").append("text").attr("x",Z/2).attr("y",Z-10+et).attr("text-anchor","middle").attr("fill","currentColor").attr("font-size",12).attr("font-weight","bold").text(`${w} ↔ ${$}: ${R} movie${R!==1?"s":""} together`)}).on("pointerleave",function(m,b){O(this).attr("fill-opacity",v(b)?1:.67),d.selectAll(".chord-tooltip").remove()}).on("contextmenu",function(m,b){m.preventDefault();const w=t.actors[b.source.index]??"",$=t.actors[b.target.index]??"",R=Math.max(b.source.value,b.target.value),A=`${w}	${$}	${R}`;navigator.clipboard.writeText(A).then(()=>{d.append("g").attr("pointer-events","none").attr("class","chord-tooltip chord-copied").append("text").attr("x",Z/2).attr("y",Z-10+et).attr("text-anchor","middle").attr("fill","currentColor").attr("font-size",12).attr("font-weight","bold").text("Copied to clipboard"),setTimeout(()=>d.selectAll(".chord-copied").remove(),1200)})}),p.append("g").selectAll("path").data(h).join("path").attr("fill",m=>s(t.actors[m.index]??"")).attr("stroke",m=>y(t.actors[m.index]??"")).attr("stroke-width",2).attr("d",o);const g=kn().innerRadius(i+55).outerRadius(i+55);return p.append("g").selectAll("text").data(h).join("text").attr("transform",m=>{const[b,w]=g.centroid(m),$=(m.startAngle+m.endAngle)/2,R=$<Math.PI?$*(180/Math.PI)-90:$*(180/Math.PI)+90;return`translate(${b},${w}) rotate(${R})`}).attr("text-anchor","middle").attr("font-size",10).attr("fill","currentColor").style("pointer-events","none").text(m=>t.actors[m.index]??""),()=>{d.selectAll(".chord-tooltip").remove()}},[t,n,r]),t.actors.length<2?T.jsx("div",{className:"rounded-lg border border-dashed border-gray-300 bg-gray-50 px-6 py-8 text-center text-sm text-gray-500 dark:border-gray-600 dark:bg-gray-800/50 dark:text-gray-400",children:"Not enough connections with the current filters. Try lowering min movies per connection or widening the year range."}):T.jsx("div",{className:"flex flex-col gap-2",children:T.jsx("svg",{ref:e,width:Z+et*2,height:Z+et*2,className:"mx-auto overflow-visible"})})}export{Gr as C,Dr as D,Cr as E,Lr as S,Er as a,jr as b,Pr as c,Ir as d,_r as e,zr as f,Fr as g,Rr as h,Sr as i,Nn as j,Tr as k,Br as l};
